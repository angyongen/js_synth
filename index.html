<!DOCTYPE html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Javascript Synthesizer</title>
<script src=".\settings.js"></script>
<script src=".\sounds.js"></script>
<script src=".\wav.js"></script>
<script src=".\script.js"></script>
<script src=".\web_audio_api.js"></script>
<style type="text/css">
	*{box-sizing: border-box;}
	form{ font-size:20px}
	input[type="checkbox"]{width: 3em;	height: 3em;}
	input[type="radio"]{width: 3em;	height: 3em;}
	input[type="range"]{width: 100%;	height: 2em;}
	.w,.b {position: relative; display: inline-block; border: 0.2em solid black;}
	.w { width:3em; height:11em; margin: 0 -0.1em 0 -0.1em;  background: white; z-index:0;}
	.b { width:2em; height:7em; margin: 0 -1em 4em -1em; background: black; z-index:1;}
</style>
</head>
<body>
	<a href="/" style="font-size: 200%">back</a><br>
	<div id="soundplayers"></div>
	<form name="form" style="height:100%">  
    <input type="radio" name="soundchoice" onclick="updateSoundChoice()" value="0" disabled>Piano
    <input type="radio" name="soundchoice" onclick="updateSoundChoice()" value="1" disabled>Organ
    <input type="radio" name="soundchoice" onclick="updateSoundChoice()" value="2" checked>Acoustic Guitar
    <input type="radio" name="soundchoice" onclick="updateSoundChoice()" value="3" disabled>EDM
    <br><br>
    <input type="checkbox" name="inputchoice_vp" onclick="updateInputTypes()" checked>Virtual Piano
    <input type="checkbox" name="inputchoice_kb" onclick="updateInputTypes()">Keyboard
    <br><br>
    Notes Length = <span id="time_display"></span>
    <input type="range" min="1" max="10" value="5" class="slider" name="time" oninput="updateTimeChoice()">
			
    <div id="input_kb">
    	Keyboard Offset = <span id="kb_offset_display"></span>
    	<input type="range" min="21" max="89" value="48" class="slider" name="kb_offset" oninput="document.getElementById('kb_offset_display').textContent = this.value">
    	<br>
	    Click here to open up the keyboard for mobile ->
			<textarea name="input"></textarea>
		</div>
		<div id="input_vp" style="font-size:12px">
			<!--<input type="range" min="1" max="100" value="50" class="slider" id="vp_scale">-->
			<br>
<div id="keys"><div class="w"></div><div class="b"></div><div class="w"></div><!--1--><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><!--2--><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><!--3--><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><!--4--><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><!--5--><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><!--6--><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><!--7--><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><div class="b"></div><div class="w"></div><!--8--><div class=w></div></div>
		</div>
    <textarea readonly name="log" style="width:100%; height:10em"></textarea>
	<sub>Inspired by <a href="https://keithwhor.com/music/">https://keithwhor.com/music/</a></sub>
	</form>
	<script>
		document.getElementById('kb_offset_display').textContent = document.form.kb_offset.value
		document.getElementById('time_display').textContent = document.form.time.value
		updateInputTypes();
		updateSoundChoice();
		updateTimeChoice();

		document.form.log.value = ""
		document.form.input.oninput = function(e) {
			var keyId = 'AWSEDFTGYHJIKL'.indexOf(this.value[this.value.length - 1].toUpperCase())
			this.value='';
			var midinote = parseInt(document.form.kb_offset.value) + keyId
			noteDown(midinote)
		}
		document.body.onkeydown = function (event) {
			event.preventDefault();
			if (document.form.inputchoice_kb.checked) {
				var keyId = keyCodeMapping.indexOf(event.keyCode)
				if (keyId != -1) {
					var midinote = parseInt(document.form.kb_offset.value) + keyId
					noteDown(midinote)
				}
			}
		}
		document.body.onkeyup = function (event) {
			if (document.form.inputchoice_kb.checked) {
				var keyId = keyCodeMapping.indexOf(event.keyCode)
				if (keyId != -1) {
					var midinote = parseInt(document.form.kb_offset.value) + keyId
					noteUp(midinote)
				}
			}
		}
		var keys = document.getElementById("keys").children
		for (var keyId = 0; keyId < keys.length; keyId++) {
			keys[keyId].id = keyId;
			keys[keyId].onclick = function(e) {noteDown(parseInt(this.id)+21)}
			keys[keyId].ontouchstart = function(e) {
				e.preventDefault();
				noteDown(parseInt(this.id)+21)
			};
		}
	</script>
</body>
